<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Cloud Pub/Sub: Capa de ingesta y desacoplamiento para pipeline de streaming serverless en GCP.">
        <meta name="keywords" content="Cloud Pub/Sub, GCP, Mensajer칤a, Topic, Subscription, Streaming">
        <title>Detalle | Cloud Pub/Sub</title>
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>

        <header class="hero">
            <div class="container">
                <h1 class="project-title">Pipeline Serverless de Streaming en
                    GCP</h1>
                <p class="subtitle">An치lisis de Transacciones en Tiempo Real
                    (Latencia Baja)</p>
            </div>
        </header>

        <nav class="tool-nav">
            <div class="container">
                <a href="index.html" class="nav-item"
                    data-tool="overview">Visi칩n General</a>
                <a href="pubsub.html" class="nav-item active"
                    data-tool="pubsub">Cloud Pub/Sub</a>
                <a href="dataflow.html" class="nav-item"
                    data-tool="dataflow">Cloud Dataflow</a>
                <a href="bigquery.html" class="nav-item"
                    data-tool="bigquery">BigQuery</a>
                <a href="apachebeam.html" class="nav-item"
                    data-tool="apachebeam">Apache Beam (Python)</a>
            </div>
        </nav>

        <main class="container main-content">
            <section class="section tool-detail-content">
                <h2>Cloud Pub/Sub: Capa de Ingesta y Desacoplamiento</h2>
                <p>Cloud Pub/Sub es un servicio de mensajer칤a as칤ncrona y
                    globalmente distribuido que implementa el patr칩n de
                    <strong>Publicador/Suscriptor</strong>. En este proyecto, act칰a como el
                    <strong>puente resiliente</strong> entre la fuente de datos (el
                    simulador) y el procesador (Dataflow).</p>

                <h3>Conceptos Clave Aplicados</h3>

                <div class="component-list">
                    <ul>
                        <li>
                            <h4>Topic (Tema)</h4>
                            <p>El canal donde el script de simulaci칩n (el
                                <strong>Publicador</strong>) env칤a cada mensaje de
                                transacci칩n JSON. Se us칩 el Topic
                                <code>transactions-topic</code>.</p>
                        </li>
                        <li>
                            <h4>Subscription (Suscripci칩n)</h4>
                            <p>El punto l칩gico al que Dataflow se conecta para
                                leer los mensajes. La Suscripci칩n
                                <code>dataflow-subscription</code> garantiza la
                                entrega de mensajes de
                                <strong>"al menos una vez"</strong>.</p>
                        </li>
                        <li>
                            <h4>Desacoplamiento y Durabilidad</h4>
                            <p>Su naturaleza *serverless* y su funci칩n de
                                *buffer* permiten que Dataflow pueda fallar o
                                recibir mantenimiento sin perder ni un solo
                                mensaje, ya que Pub/Sub los retiene
                                temporalmente.</p>
                        </li>
                    </ul>
                </div>

                <a href="https://cloud.google.com/pubsub" target="_blank" rel="noopener noreferrer"
                    class="official-link">Documentaci칩n Oficial de Google Cloud
                    Pub/Sub</a>
            </section>

            <!-- Quiz de Certificaci칩n -->
            <section class="section quiz-container">
                <h2 class="quiz-title">游닇 Quiz de Certificaci칩n: Cloud Pub/Sub</h2>
                <p class="quiz-intro">Pon a prueba tus conocimientos con preguntas tipo Professional Data Engineer</p>
                <div id="pubsubQuiz"></div>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 Eduardo Villena Lozano | Ingenier칤a de Datos</p>
        </footer>

        <script src="js/main.js"></script>
        <script src="js/quiz.js"></script>
        <script>
            // Preguntas espec칤ficas de Cloud Pub/Sub para Professional Data Engineer
            const pubsubQuestions = [
                {
                    question: "Una empresa necesita procesar millones de mensajes por segundo desde dispositivos IoT. 쮺u치l es la garant칤a de entrega que Cloud Pub/Sub proporciona por defecto?",
                    options: [
                        "Exactamente una vez (exactly-once)",
                        "Al menos una vez (at-least-once)",
                        "Como m치ximo una vez (at-most-once)",
                        "Sin garant칤a de entrega"
                    ],
                    correct: 1,
                    explanation: "Cloud Pub/Sub garantiza entrega 'al menos una vez' por defecto. Esto significa que los mensajes pueden duplicarse, pero nunca se perder치n. Para 'exactly-once', debes implementar l칩gica de deduplicaci칩n o usar Dataflow con exactly-once processing."
                },
                {
                    question: "Est치s dise침ando un pipeline de datos en tiempo real. Necesitas que m칰ltiples servicios procesen el mismo mensaje de forma independiente. 쮺u치l es la mejor configuraci칩n en Pub/Sub?",
                    options: [
                        "Un topic con m칰ltiples subscriptions, cada una para un servicio diferente",
                        "M칰ltiples topics, uno por cada servicio",
                        "Un topic con una subscription compartida entre servicios",
                        "Usar Cloud Functions para replicar mensajes"
                    ],
                    correct: 0,
                    explanation: "La mejor pr치ctica es crear UN topic con M칔LTIPLES subscriptions. Cada subscription recibe una copia de todos los mensajes del topic, permitiendo que diferentes servicios consuman los mismos datos de forma independiente. Este patr칩n de fan-out es fundamental en arquitecturas de streaming."
                },
                {
                    question: "Tu aplicaci칩n est치 recibiendo mensajes de Pub/Sub, pero algunos mensajes tardan m치s en procesarse. 쯈u칠 mecanismo debes usar para evitar que estos mensajes se reenv칤en mientras a칰n se est치n procesando?",
                    options: [
                        "Aumentar el retention period del topic",
                        "Extender el acknowledgement deadline",
                        "Usar message ordering",
                        "Configurar dead letter topics"
                    ],
                    correct: 1,
                    explanation: "Debes extender el 'acknowledgement deadline'. Por defecto es de 10 segundos, pero puedes extenderlo hasta 600 segundos. Esto le indica a Pub/Sub que el mensaje a칰n est치 siendo procesado y no debe reenviarse. Esto se hace con el m칠todo 'modify_ack_deadline' en el SDK."
                },
                {
                    question: "쮺u치l es el tiempo m치ximo de retenci칩n de mensajes en Cloud Pub/Sub?",
                    options: [
                        "1 d칤a",
                        "7 d칤as",
                        "31 d칤as",
                        "Ilimitado con snapshots"
                    ],
                    correct: 1,
                    explanation: "Cloud Pub/Sub retiene mensajes no confirmados por un m치ximo de 7 d칤as. Despu칠s de este per칤odo, los mensajes se eliminan autom치ticamente. Para retenci칩n a largo plazo, debes usar Pub/Sub snapshots o exportar a Cloud Storage/BigQuery."
                },
                {
                    question: "Necesitas garantizar el orden de procesamiento de mensajes relacionados (ej: transacciones del mismo usuario). 쯈u칠 caracter칤stica de Pub/Sub debes habilitar?",
                    options: [
                        "Message deduplication",
                        "Message filtering",
                        "Message ordering con ordering keys",
                        "Priority queuing"
                    ],
                    correct: 2,
                    explanation: "Debes habilitar 'message ordering' y usar 'ordering keys'. Los mensajes con la misma ordering key se entregar치n en orden. IMPORTANTE: Esto reduce el paralelismo y puede afectar el throughput. Solo 칰salo cuando el orden sea cr칤tico. Adem치s, debes procesar mensajes de la misma ordering key secuencialmente."
                },
                {
                    question: "Tu aplicaci칩n procesa mensajes de Pub/Sub, pero ocasionalmente algunos mensajes no se procesan correctamente y se pierden. 쮺u치l es la mejor estrategia para manejar mensajes problem치ticos?",
                    options: [
                        "Aumentar el acknowledgement deadline a su m치ximo",
                        "Configurar un Dead Letter Topic con max delivery attempts",
                        "Duplicar todas las subscriptions para redundancia",
                        "Deshabilitar el acknowledgement autom치tico"
                    ],
                    correct: 1,
                    explanation: "La mejor pr치ctica es configurar un Dead Letter Topic. Cuando un mensaje falla despu칠s de un n칰mero configurado de intentos de entrega (max_delivery_attempts), se mueve autom치ticamente al Dead Letter Topic en lugar de reintentarse infinitamente. Esto previene que mensajes problem치ticos bloqueen el pipeline y permite an치lisis posterior de fallos. Configura tanto el Dead Letter Topic como la pol칤tica de reintento (max_delivery_attempts y minimum/maximum backoff)."
                },
                {
                    question: "쮺u치l es el l칤mite m치ximo de throughput de publicaci칩n en un solo topic de Cloud Pub/Sub?",
                    options: [
                        "1 MB/s por topic",
                        "10 MB/s por topic",
                        "No hay l칤mite fijo, escala autom치ticamente",
                        "Depende del n칰mero de subscriptions"
                    ],
                    correct: 2,
                    explanation: "Cloud Pub/Sub escala autom치ticamente sin l칤mite fijo de throughput por topic. Puede manejar desde bytes hasta petabytes por segundo. El servicio particiona autom치ticamente los topics seg칰n la carga. Sin embargo, hay l칤mites de cuota por proyecto (ej: 10,000 mensajes/segundo para ciertas operaciones por defecto, pero se puede aumentar). Para casos de uso extremadamente altos, Google recomienda usar m칰ltiples topics para distribuci칩n de carga."
                },
                {
                    question: "Est치s migrando de un sistema on-premise con colas FIFO estrictas a Pub/Sub. 쯈u칠 consideraci칩n arquitect칩nica es m치s importante?",
                    options: [
                        "Pub/Sub garantiza FIFO global por defecto, no hay cambios necesarios",
                        "Debes habilitar message ordering y redese침ar para tolerar latencia adicional",
                        "Pub/Sub no soporta orden, debes usar Cloud Tasks en su lugar",
                        "Solo funciona FIFO si usas una 칰nica subscription"
                    ],
                    correct: 1,
                    explanation: "Pub/Sub NO garantiza orden global por defecto (optimizado para throughput). Para orden FIFO: 1) Habilita 'enable_message_ordering' en subscription, 2) Publica mensajes con 'ordering_key', 3) Mensajes con la MISMA ordering_key se entregar치n en orden. IMPORTANTE: Esto reduce paralelismo (mensajes de misma key se procesan secuencialmente), aumenta latencia, y requiere manejo cuidadoso de errores (un fallo bloquea esa key). Eval칰a si realmente necesitas orden estricto vs 'eventual consistency'."
                },
                {
                    question: "쮺u치ndo deber칤as usar 'Pub/Sub Lite' en lugar de 'Pub/Sub est치ndar'?",
                    options: [
                        "Cuando necesitas latencia ultra-baja (sub-milisegundo)",
                        "Cuando el costo es cr칤tico y puedes manejar disponibilidad zonal",
                        "Para mensajes mayores a 10 MB",
                        "Solo para aplicaciones en GKE"
                    ],
                    correct: 1,
                    explanation: "Pub/Sub Lite es hasta 90% m치s econ칩mico que Pub/Sub est치ndar, PERO: 1) Solo disponibilidad ZONAL (no regional/global), 2) Debes pre-provisionar capacidad (throughput y almacenamiento), 3) Menos features (no snapshots, no dead letter topics, no seeks). 칔salo cuando: cost es cr칤tico, tu workload es predecible, y puedes aceptar disponibilidad zonal. Para producci칩n cr칤tica, usa Pub/Sub est치ndar con disponibilidad regional."
                },
                {
                    question: "Tu pipeline consume mensajes de Pub/Sub, pero durante picos de tr치fico, los mensajes se acumulan y el lag aumenta. 쮺u치l es la causa m치s probable y la soluci칩n?",
                    options: [
                        "Pub/Sub tiene l칤mites de throughput, debes crear m치s topics",
                        "Tu consumidor no escala adecuadamente, debes aumentar el paralelismo/workers",
                        "Los mensajes son demasiado grandes, debes comprimirlos",
                        "La subscription tiene un acknowledgement deadline muy corto"
                    ],
                    correct: 1,
                    explanation: "El problema est치 en el CONSUMIDOR, no en Pub/Sub. Pub/Sub escala autom치ticamente, pero tu aplicaci칩n debe procesar mensajes lo suficientemente r치pido. Soluciones: 1) Aumentar n칰mero de workers/pods en tu aplicaci칩n, 2) Aumentar el 'max_messages' en pull requests (procesar mensajes en batch), 3) Optimizar la l칩gica de procesamiento, 4) Usar streaming pull en lugar de sync pull para mayor eficiencia. Monitorea 'oldest_unacked_message_age' para detectar lag."
                }
            ];

            // Inicializar quiz cuando el DOM est칠 listo
            document.addEventListener('DOMContentLoaded', () => {
                new Quiz('pubsubQuiz', pubsubQuestions);
            });
        </script>
    </body>
</html>